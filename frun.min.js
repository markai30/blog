function inforeplace(t,e){for(var i=t.length,n=e;n>1;n--){var a=t.charAt(n);if(" "==a)return t.splice(n,i,"...")}}function setoption(t){var e=t.attr("href").match(/\d/),i=t.text(),n='<a data="'+e+'" onclick="setforum.call(this)" title="'+i+'" href="javascript:;">'+i+"</a>",a='<span class="option">'+n+"</span>",r='<li onclick="setprefix.call(this)" class="row-prefix">'+i+"</li>";$(".catalogue-list .wbb-list").append(a),$(".prefix-list").append(r)}function setprefix(){var t=$(this).text();$showprefix=!0,$(".prefix-input").val(t),$(".prefix-list").hide()}function copy_link(){var t=$(this).attr("src");$(".description-input input").val(t),$(".list-img").removeClass("show").addClass("hide")}function setforum(){var t=$(window).scrollTop(),e=$(this).attr("data"),i=$(this).text();if($forum.length>1&&$forum!=i){var n=$('#tagBox input[value="'+$forum.toLowerCase()+'"]').closest(".tag");n.find(".tag-i").trigger("click"),n.remove(),$(".type-zone").val("")}($forum!=i||$tag_box.tagging("getTags").toString().toUpperCase().indexOf($forum.toUpperCase())<0)&&($forum=i,$tag_box.tagging("add",$forum)),$('.submit-editor input[name="f"]').attr("value",e),$(this).closest(".wbb-list").find(".selected").removeClass("selected"),$(this).parent().addClass("selected"),$(".catalogue-list .wbb-select .val").text(i),$(".catalogue-list .wbb-list").hide(),$(window).scrollTop(t)}function uploadimg(){if(0==$("#body-upload").length){$(".wysibb-body").after('<div id="body-upload" style="display:block"><div class="dropzone" style="display:block"></div></div>').hide();var t=function(t){if(t.success===!0){$("#body-upload").hide();var e='<img src="'+t.data.link+'" /><br>';$(".wysibb-body").append(e),$(".wysibb-body").show();var i=$('img[src="'+t.data.link+'"]:last').offset().top;i>600&&$("html, body").animate({scrollTop:i},500)}};new Imgur({clientid:"cc121d51c7632a1",callback:t})}else{var e=$("#body-upload").attr("style");e.indexOf("none")>-1?($("#body-upload").show(),$(".wysibb-body").hide()):($("#body-upload").hide(),$(".wysibb-body").show())}}function settag(t){var e;return $.each(t,function(i){var n=t[i].replace(/\s/gi,"-"),a="#"+n+",";e+=a}),e.replace(/[ ]/g,"").split(",").removeDuplicate().join(", ").replace(/undefined|\,$/g,"")}!function(t,e){"use strict";"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?module.exports=e():t.Imgur=e()}(this,function(){"use strict";var t=function(e){if(!(this&&this instanceof t))return new t(e);if(e||(e={}),!e.clientid)throw"Provide a valid Client Id here: http://api.imgur.com/";this.clientid=e.clientid,this.endpoint="https://api.imgur.com/3/image",this.callback=e.callback||void 0,this.dropzone=document.querySelectorAll(".dropzone"),this.run()};return t.prototype={createEls:function(t,e,i){var n,a=document.createElement(t);for(n in e)e.hasOwnProperty(n)&&(a[n]=e[n]);return i&&a.appendChild(document.createTextNode(i)),a},insertAfter:function(t,e){t.parentNode.insertBefore(e,t.nextSibling)},post:function(t,e,i){var n=new XMLHttpRequest;n.open("POST",t,!0),n.setRequestHeader("Authorization","Client-ID "+this.clientid),n.onreadystatechange=function(){if(4===this.readyState){if(!(this.status>=200&&this.status<300))throw new Error(this.status+" - "+this.statusText);var t="";try{t=JSON.parse(this.responseText)}catch(e){t=this.responseText}i.call(window,t)}},n.send(e),n=null},createDragZone:function(){var t,e;t=this.createEls("p",{},""),e=this.createEls("input",{type:"file",accept:"image/*",onchange:"document.getElementById('img-preview').src = window.URL.createObjectURL(this.files[0])"}),Array.prototype.forEach.call(this.dropzone,function(e){e.appendChild(t),$(".dropzone p").html('<span class="load-img-up"><img id="img-preview" src=""></span><span style="margin-left:20px"><i class="fa fa-file-image-o" aria-hidden="true" style="font-size: 40px;margin-right: 10px;"></i><i>Thả file hoặc click vào đây để upload ảnh.</i></span>'),$(".dropzone").append('<input onchange="document.getElementById(\'img-preview\').src = window.URL.createObjectURL(this.files[0])" type="file" accept="image/*">'),this.status(e),this.upload(e)}.bind(this))},loading:function(){},status:function(t){var e=this.createEls("div",{className:"status"});this.insertAfter(t,e)},matchFiles:function(t,e){var i=e.nextSibling;if(t.type.match(/image/)&&"image/svg+xml"!==t.type){$(".load-img-up").addClass("load"),$(".dropzone input").attr("disabled","disabled"),i.classList.remove("bg-success","bg-danger"),i.innerHTML="";var n=new FormData;n.append("image",t),this.post(this.endpoint,n,function(t){$(".load-img-up").removeClass("load"),$(".dropzone input").removeAttr("disabled"),"function"==typeof this.callback&&this.callback.call(this,t)}.bind(this))}else i.classList.remove("bg-success"),i.classList.add("bg-danger"),i.innerHTML="Invalid archive"},upload:function(t){var e,i,n,a,r=["dragenter","dragleave","dragover","drop"];t.addEventListener("change",function(r){if(r.target&&"INPUT"===r.target.nodeName&&"file"===r.target.type)for(i=r.target.files,n=0,a=i.length;a>n;n+=1)e=i[n],this.matchFiles(e,t)}.bind(this),!1),r.map(function(e){t.addEventListener(e,function(t){t.target&&"INPUT"===t.target.nodeName&&"file"===t.target.type&&("dragleave"===e||"drop"===e?t.target.parentNode.classList.remove("dropzone-dragging"):t.target.parentNode.classList.add("dropzone-dragging"))},!1)})},run:function(){var t=document.querySelector(".loading-modal");t||this.loading(),this.createDragZone()}},t}),function(t,e,i,n){var a=function(e,i){this.elem=e,this.$elem=t(e),this.options=i,this.tags=[]};a.prototype={keys:{add:{comma:188,enter:13,spacebar:32},remove:{del:46,backspace:8}},defaults:{"case-sensitive":!1,"close-char":"&times;","close-class":"tag-i","edit-on-delete":!0,"forbidden-chars":[".","_","?"],"forbidden-chars-callback":e.alert,"forbidden-chars-text":"Từ này bị cấm:","forbidden-words":[],"forbidden-words-callback":e.alert,"forbidden-words-text":"Forbidden word:","no-backspace":!1,"no-comma":!1,"no-del":!1,"no-duplicate":!0,"no-duplicate-callback":e.alert,"no-duplicate-text":"Nhãn này bị trùng:","no-enter":!1,"no-spacebar":!0,"pre-tags-separator":", ","tag-box-class":"tagging","tag-char":"#","tag-class":"tag","tags-input-name":"tag","tag-on-blur":!0,"type-zone-class":"type-zone"},add:function(e){var n,a,r,o,s,l,c;if(r=this,t.isArray(e))return t.each(e,function(){r.add(this+"")});if(s=r.config["forbidden-words"],e||(e=r.valInput(),r.emptyInput()),!e||!e.length)return!1;for(r.config["case-sensitive"]||(e=e.toLowerCase()),a=s.length;a--;)if(o=e.indexOf(s[a]),o>=0)return r.emptyInput(),l=r.config["forbidden-words-callback"],c=r.config["forbidden-words-text"],r.throwError(l,c,e);if(r.config["no-duplicate"])for(a=r.tags.length;a--;)if(r.tags[a].pure_text===e)return r.emptyInput(),l=r.config["no-duplicate-callback"],r.throwError(l,c,e);return n=t(i.createElement("div")).addClass(r.config["tag-class"]).html("<span>"+r.config["tag-char"]+"</span> "+e),t(i.createElement("input")).attr("type","hidden").attr("name",r.config["tags-input-name"]+"[]").val(e).appendTo(n),t(i.createElement("a")).attr("role","button").addClass(r.config["close-class"]).html(r.config["close-char"]).click(function(){r.remove(n)}).appendTo(n),n.pure_text=e,r.tags.push(n),r.$type_zone.before(n),!0},addSpecialKeys:function(e){var i,n,a,r,o;if(i=this,o=e[0],r=e[1],a={},t.isArray(r))return t.each(r,function(){i.addSpecialKeys([o,this])});if(!r&&r.constructor!==Object)return"Error -> The second argument is not an Object!";for(n in r)r.hasOwnProperty(n)&&r[n]===+r[n]&&r[n]===(0|r[n])&&t.extend(a,r);return i.keys[o]=t.extend({},a,i.keys[o]),i.keys[o]},destroy:function(){return this.$elem.find("."+this.config["type-zone-class"]).remove(),this.$elem.find("."+this.config["tag-class"]).remove(),this.$elem.data("tag-box",null),!0},emptyInput:function(){return this.focusInput(),this.valInput("")},focusInput:function(){return this.$type_zone.focus()},getDataOptions:function(){var t,e,i;i={};for(t in this.defaults)e=this.$elem.data(t),e&&(i[t]=e);return i},getSpecialKeys:function(){return t.extend({},this.keys.add,this.keys.remove)},getSpecialKeysD:function(){return this.keys},getTags:function(){var t,e,i;for(i=this.tags.length,t=[],e=0;i>e;e+=1)t.push(this.tags[e].pure_text);return t},getTagsObj:function(){return this.tags},init:function(){var e,n,a;return n=this,n.config=t.extend({},n.defaults,n.options,n.getDataOptions()),e=n.$elem.text(),n.$elem.empty(),n.$type_zone=t(i.createElement("input")).addClass(n.config["type-zone-class"]).attr("contenteditable",!0),n.$elem.addClass(n.config["tag-box-class"]).append(n.$type_zone),n.$type_zone.keydown(function(t){var e,i,a,r,o,s,l,c,d;if(o=n.getSpecialKeys(),s=n.config["forbidden-chars"],l=n.valInput(),r=t.which,l){for(a=s.length;a--;)if(i=l.indexOf(s[a]),i>=0)return t.preventDefault(),l=l.replace(s[a],""),n.focusInput(),n.valInput(l),c=n.config["forbidden-chars-callback"],d=n.config["forbidden-chars-text"],n.throwError(c,d,s[a]);for(e in n.keys.add)if(r===n.keys.add[e]&&!n.config["no-"+e])return t.preventDefault(),n.add()}else for(e in o)if(r===o[e]){if(n.keys.add[e])return t.preventDefault(),!0;if(n.keys.remove[e]&&!n.config["no-"+e])return t.preventDefault(),n.remove()}return!0}),n.config["tag-on-blur"]&&n.$type_zone.focusout(function(){return a=n.valInput(),a&&a.length?n.add():!1}),n.$elem.on("click",function(){n.focusInput()}),n.refresh(e),n},refresh:function(e){var i,n;return i=this,n=i.config["pre-tags-separator"],e=e||i.getTags().join(n),i.reset(),t.each(e.split(n),function(){i.add(this+"")}),!0},remove:function(e){var i,n,a;if(i=this,t.isArray(e))return t.each(e,function(){i.remove(this+"")});if("string"==typeof e&&(n=e,e=i.$elem.find("input[value="+n+"]").parent(),!e.length))return"Error -> Tag not found";if(e)for(a=i.tags.length;a--;)i.tags[a][0].innerHTML===e[0].innerHTML&&i.tags.splice(a,1);else e=i.tags.pop();return n=n||e.pure_text,e.remove(),i.config["edit-on-delete"]&&(i.emptyInput(),i.valInput(e.pure_text)),e},removeAll:function(){return this.reset()},removeSpecialKeys:function(e){var i,a,r,o,s;if(i=this,s=e[0],o=e[1],r={},t.isArray(o))return t.each(o,function(){i.removeSpecialKeys([s,this])});for(a in i.keys[s])i.keys[s].hasOwnProperty(a)&&i.keys[s][a]===o&&(i.keys[s][a]=n);return i.keys[s]},reset:function(){for(;this.tags.length;)this.remove(this.tags[this.tags.length]);return this.emptyInput(),this.tags},throwError:function(t,e,i){return t([e+" '"+i+"'."])},valInput:function(t){return null==t?this.$type_zone.val():this.$type_zone.val(t)}},t.fn.tagging=function(e,i){var n=[];return this.each(function(){var r,o,s;r=t(this),o=r.data("tag-box"),o?(s=o[e](i),s&&n.push(s)):(o=new a(this,e),r.data("tag-box",o),o.init(),n.push(o.$elem))}),"string"==typeof e?n.length>1?n:n[0]:n}}(window.jQuery,window,document),function(t){t.GoogleURLShortener=function(e){var i=t.extend({key:null,mode:"auto",url:null,success:function(t,e){},error:function(t,e){}},e),n=function(t){i.error(t,{error:{code:400,message:t,data:[{domain:"global",reason:"Invalid",message:t}]}})},a=i.url;""!==a&&/\b((?:https?:\/\/|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))/.test(a)&&!/^http:\/\/goo\.gl\/?$/.test(a)?(window.gapi_onload=function(t){var e=gapi.client;e.setApiKey(i.key),e.load("urlshortener","v1",function(t){if("object"==typeof t)i.error(t.error.message,t);else{t=i.mode;var r,o;switch("auto"==t&&(t=/http:\/\/goo\.gl\/.+/.test(a)?"short":"long"),t){case"long":r=e.urlshortener.url.insert({resource:{longUrl:a}}),o="id";break;case"short":r=e.urlshortener.url.get({shortUrl:a}),o="longUrl"}r?r.execute(function(t){t.error?i.error(t.error.message,t):null!==t[o]?i.success(t[o],t):i.error(t.error.message,t)}):n("Invalid Setting")}})},t.getScript("https://apis.google.com/js/client.js")):n("Invalid Value")}}(jQuery),String.prototype.splice=function(t,e,i){return this.substr(0,t)+i+this.substr(e,this.length)};var npost=location.hash.match(/\d+/),$forum="";if(null!=npost)var edit=!0;else var edit=!1;$(function(){$("#editor").wysibb(),$(".catalogue-list .wbb-select").toggle(function(){$(".catalogue-list .wbb-list").show()},function(){$(".catalogue-list .wbb-list").hide()});var t=$("#tagBox").tagging();$tag_box=t[0],1!=edit?($tag_box.tagging("add","news"),$listforum=sessionStorage.getItem("listforum"),null!=$listforum?$(".list-cate-top .title-link").each(function(){setoption($(this))}):$.get("/").done(function(t){$(t).find(".link-column .title-link").each(function(){setoption($(this))})})):($(".catalogue-list").remove(),$("#loading,#load-content").fadeIn(500),$.get("/post?p="+npost+"&mode=editpost").done(function(t){if($(t).find("#text_editor_textarea").length>0){var e=$(t).find("#text_editor_textarea").text(),i=e.match(/\[sub\]\[hr\](.+)\[\/sub\]/);if(null!=i){var e=e.replace(/\[sub\]\[hr\](.+)\[\/sub\]/,""),n=i[1].replace(/#/g,""),n=n.split(",");$.each(n,function(t){n[t].length>3&&$tag_box.tagging("add",n[t])})}var a=$(t).find('input[name="subject"]').val(),r=a.split("||"),a=r[1],o=$(t).find('input[name="description"]').val();$(".prefix-input").val(r[0]),$(".subject-input").val(a),$(".description-input input").val(o);var s=$(t).find('.submit-buttons input[type="hidden"]');$(".wysibb-body").html(e),$(".modesw").trigger("click"),$(".modesw").trigger("click"),$('.submit-editor input[type="hidden"]').remove(),$(".submit-editor").append(s),$("#loading,#load-content").fadeOut(500)}else alert("Bạn không có quyền sửa bài"),location.href="/"})),$(".btt-submit").click(function(t){var e=!0,i=$(".subject-input").val(),n=$(".description-input input").val(),a=$(".wysibb-body"),r=$tag_box.tagging("getTags"),o=$('.submit-editor input[name="f"]').val(),s=$("#editor").bbcode(),l=(i.match(/^(\[.+\])(?=\s)|^(?=\s)(\[.+\])(?=\s)|^(\[.+\])(?=\w)/),a.find('a[href*="youtube"]').attr("href")),c=a.find("img:first").attr("src"),d=$(".prefix-input").val();if(0==d.length)return note("Bạn chưa đặt tiền tố cho bài viết.","Lỗi Tiền Tố"),!1;if(i.length<15)return note("Tiêu đề bài viết quá ngắn.","Lỗi Tiêu Đề"),!1;if(i.length>255)return note("Tiêu đề bài viết quá dài.","Lỗi Tiêu Đề"),!1;if(0==n.length||0==/\.jpg|\.gif|\.png|\.jpeg/.test(n))if(void 0!=c)$(".description-input input").val(c);else if(void 0==l)return note("Bạn phải điền ảnh giới thiệu vào bài viết. Và định dạng ảnh phải là png,jpg hoặc gif mới được.","Lỗi link ảnh giới thiệu"),!1;if(0==edit&&0==o.length)return note("Xin vui lòng chọn chuyên mục để gửi bài.","Chưa chọn chuyên mục"),!1;if(0==s.length)return note("Xin vui lòng nhập nội dung bài viết.","Nội dung bài viết"),!1;if(s.length<300&&void 0==l&&void 0!=l)return note("Nội dung bài viết của bạn quá ngắn.","Nội dung bài viết"),!1;if(s.length>9e3)return note("Nội dung bài viết của bạn quá dài","Nội dung bài viết"),!1;if($(this).attr("disabled","disabled"),loading(!0),void 0!=l){var u=l.match(/^http[s]*:\/\/www\.youtube\.com\/(?:watch|embed)(?:\?.*?v=|\/)([a-z0-9_-]+)/i);if(null!=u){var c="http://img.youtube.com/vi/"+u[1]+"/sddefault.jpg";$(".description-input input").val(c)}}if(void 0==c&&void 0!=n)var c=n;console.log(c),void 0!=c&&(e=!1,$.GoogleURLShortener({key:"AIzaSyA3M834Rk4jS0L3GkVa8vj9x7FusIH57hs",mode:"auto",url:c,success:function(t,e){var n=d+"||"+i+"||"+t,o=n.length;if(!(255>o))return note("Tiêu đề bài viết quá dài","Tiêu đề quá dài"),!1;var l=$(a.html().replace(/\<br\>|\<\/br\>/g,".")).text(),c=250-o;if(l.length>=c)var l=l.slice(0,c),l=inforeplace(l,l.length);if(n+="||"+l,$(".subject-input").val(n).addClass("active"),0==edit){var u=s.match(/([A-Z]\w+\s[A-Z]\w+(?=\s|\.|\,|\!|\?))/g);if(null!=u)var u=settag(u);else u="";var p=settag(r);if(u+=p,null!=f){var f=f[0].replace(/\[|\]/g,"");if(f!=$(".catalogue-list .option.selected").text()){var f="#"+f.replace(/\s/g,"-");u+=f}}}else r.length>0&&(u=settag(r));a.append('<div class="tag-list">[sub][hr]'+u+"[/sub]</div>"),$("#editor").sync(),setTimeout(function(){$('.submit-editor input[type="submit"]').trigger("click")},1e3)}}))}),$(".album-img").click(function(){var t=$(".list-img"),e=t.attr("class");if(0==t.find(".out-img img").length){var i=$(".wysibb-body img");if(i.length>0){t.find(".no-img").hide();var n="";i.each(function(){n+='<img src="'+this.src+'" onclick="copy_link.call(this)">'}),t.find(".out-img").html(n)}else t.find(".no-img").show()}e.indexOf("show")>-1?(t.removeClass("show").addClass("hide"),t.find(".out-img").html("")):t.removeClass("hide").addClass("show")}),$(".prefix-input").blur(function(){setTimeout(function(){$(".prefix-list").hide()},1e3)}),$(".prefix-input").focus(function(){$(".prefix-list").show()})}),Array.prototype.removeDuplicate=function(){for(var t=[],e=0;e<this.length;e++)-1==t.indexOf(this[e])&&t.push(this[e]);return t},window.addEventListener("scroll",function(t){var e=$(window).scrollTop(),i=$(".wysibb-text").offset().top;e>i?$(".wysibb-toolbar").addClass("fixed"):$(".wysibb-toolbar").removeClass("fixed"),e>$(document).height()-1e3?$(".btt-submit").removeClass("fixed"):$(".btt-submit").addClass("fixed")},!1);
