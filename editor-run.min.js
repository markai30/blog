!function(e,t){"use strict";"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?module.exports=t():e.Imgur=t()}(this,function(){"use strict";var e=function(t){if(!(this&&this instanceof e))return new e(t);if(t||(t={}),!t.clientid)throw"Provide a valid Client Id here: http://api.imgur.com/";this.clientid=t.clientid,this.endpoint="https://api.imgur.com/3/image",this.callback=t.callback||void 0,this.dropzone=document.querySelectorAll(".dropzone"),this.run()};return e.prototype={createEls:function(e,t,i){var n,a=document.createElement(e);for(n in t)t.hasOwnProperty(n)&&(a[n]=t[n]);return i&&a.appendChild(document.createTextNode(i)),a},insertAfter:function(e,t){e.parentNode.insertBefore(t,e.nextSibling)},post:function(e,t,i){var n=new XMLHttpRequest;n.open("POST",e,!0),n.setRequestHeader("Authorization","Client-ID "+this.clientid),n.onreadystatechange=function(){if(4===this.readyState){if(!(this.status>=200&&this.status<300))throw new Error(this.status+" - "+this.statusText);var e="";try{e=JSON.parse(this.responseText)}catch(t){e=this.responseText}i.call(window,e)}},n.send(t),n=null},createDragZone:function(){var e,t;e=this.createEls("p",{},""),t=this.createEls("input",{type:"file",accept:"image/*",onchange:"document.getElementById('img-preview').src = window.URL.createObjectURL(this.files[0])"}),Array.prototype.forEach.call(this.dropzone,function(t){t.appendChild(e),$(".dropzone p").html('<span class="load-img-up"><img id="img-preview" src=""></span><span style="margin-left:20px"><i class="fa fa-file-image-o" aria-hidden="true" style="font-size: 40px;margin-right: 10px;"></i><i>Thả file hoặc click vào đây để upload ảnh.</i></span>'),$(".dropzone").append('<input onchange="document.getElementById(\'img-preview\').src = window.URL.createObjectURL(this.files[0])" type="file" accept="image/*">'),this.status(t),this.upload(t)}.bind(this))},loading:function(){},status:function(e){var t=this.createEls("div",{className:"status"});this.insertAfter(e,t)},matchFiles:function(e,t){var i=t.nextSibling;if(e.type.match(/image/)&&"image/svg+xml"!==e.type){$(".load-img-up").addClass("load"),$(".dropzone input").attr("disabled","disabled"),i.classList.remove("bg-success","bg-danger"),i.innerHTML="";var n=new FormData;n.append("image",e),this.post(this.endpoint,n,function(e){$(".load-img-up").removeClass("load"),$(".dropzone input").removeAttr("disabled"),"function"==typeof this.callback&&this.callback.call(this,e)}.bind(this))}else i.classList.remove("bg-success"),i.classList.add("bg-danger"),i.innerHTML="Invalid archive"},upload:function(e){var t,i,n,a,s=["dragenter","dragleave","dragover","drop"];e.addEventListener("change",function(s){if(s.target&&"INPUT"===s.target.nodeName&&"file"===s.target.type)for(i=s.target.files,n=0,a=i.length;a>n;n+=1)t=i[n],this.matchFiles(t,e)}.bind(this),!1),s.map(function(t){e.addEventListener(t,function(e){e.target&&"INPUT"===e.target.nodeName&&"file"===e.target.type&&("dragleave"===t||"drop"===t?e.target.parentNode.classList.remove("dropzone-dragging"):e.target.parentNode.classList.add("dropzone-dragging"))},!1)})},run:function(){var e=document.querySelector(".loading-modal");e||this.loading(),this.createDragZone()}},e});
!function(e,t,n,r){var a=function(t,n){this.elem=t,this.$elem=e(t),this.options=n,this.tags=[]};a.prototype={keys:{add:{comma:188,enter:13,spacebar:32},remove:{del:46,backspace:8}},defaults:{"case-sensitive":!1,"close-char":"&times;","close-class":"tag-i","edit-on-delete":!0,"forbidden-chars":[".","_","?"],"forbidden-chars-callback":t.alert,"forbidden-chars-text":"Từ này bị cấm:","forbidden-words":[],"forbidden-words-callback":t.alert,"forbidden-words-text":"Forbidden word:","no-backspace":!1,"no-comma":!1,"no-del":!1,"no-duplicate":!0,"no-duplicate-callback":t.alert,"no-duplicate-text":"Nhãn này bị trùng:","no-enter":!1,"no-spacebar":!0,"pre-tags-separator":", ","tag-box-class":"tagging","tag-char":"#","tag-class":"tag","tags-input-name":"tag","tag-on-blur":!0,"type-zone-class":"type-zone"},add:function(t){var r,a,i,o,s,c,u;if(i=this,e.isArray(t))return e.each(t,function(){i.add(this+"")});if(s=i.config["forbidden-words"],t||(t=i.valInput(),i.emptyInput()),!t||!t.length)return!1;for(i.config["case-sensitive"]||(t=t.toLowerCase()),a=s.length;a--;)if(o=t.indexOf(s[a]),o>=0)return i.emptyInput(),c=i.config["forbidden-words-callback"],u=i.config["forbidden-words-text"],i.throwError(c,u,t);if(i.config["no-duplicate"])for(a=i.tags.length;a--;)if(i.tags[a].pure_text===t)return i.emptyInput(),c=i.config["no-duplicate-callback"],i.throwError(c,u,t);return r=e(n.createElement("div")).addClass(i.config["tag-class"]).html("<span>"+i.config["tag-char"]+"</span> "+t),e(n.createElement("input")).attr("type","hidden").attr("name",i.config["tags-input-name"]+"[]").val(t).appendTo(r),e(n.createElement("a")).attr("role","button").addClass(i.config["close-class"]).html(i.config["close-char"]).click(function(){i.remove(r)}).appendTo(r),r.pure_text=t,i.tags.push(r),i.$type_zone.before(r),!0},addSpecialKeys:function(t){var n,r,a,i,o;if(n=this,o=t[0],i=t[1],a={},e.isArray(i))return e.each(i,function(){n.addSpecialKeys([o,this])});if(!i&&i.constructor!==Object)return"Error -> The second argument is not an Object!";for(r in i)i.hasOwnProperty(r)&&i[r]===+i[r]&&i[r]===(0|i[r])&&e.extend(a,i);return n.keys[o]=e.extend({},a,n.keys[o]),n.keys[o]},destroy:function(){return this.$elem.find("."+this.config["type-zone-class"]).remove(),this.$elem.find("."+this.config["tag-class"]).remove(),this.$elem.data("tag-box",null),!0},emptyInput:function(){return this.focusInput(),this.valInput("")},focusInput:function(){return this.$type_zone.focus()},getDataOptions:function(){var e,t,n;n={};for(e in this.defaults)t=this.$elem.data(e),t&&(n[e]=t);return n},getSpecialKeys:function(){return e.extend({},this.keys.add,this.keys.remove)},getSpecialKeysD:function(){return this.keys},getTags:function(){var e,t,n;for(n=this.tags.length,e=[],t=0;n>t;t+=1)e.push(this.tags[t].pure_text);return e},getTagsObj:function(){return this.tags},init:function(){var t,r,a;return r=this,r.config=e.extend({},r.defaults,r.options,r.getDataOptions()),t=r.$elem.text(),r.$elem.empty(),r.$type_zone=e(n.createElement("input")).addClass(r.config["type-zone-class"]).attr("contenteditable",!0),r.$elem.addClass(r.config["tag-box-class"]).append(r.$type_zone),r.$type_zone.keydown(function(e){var t,n,a,i,o,s,c,u,f;if(o=r.getSpecialKeys(),s=r.config["forbidden-chars"],c=r.valInput(),i=e.which,c){for(a=s.length;a--;)if(n=c.indexOf(s[a]),n>=0)return e.preventDefault(),c=c.replace(s[a],""),r.focusInput(),r.valInput(c),u=r.config["forbidden-chars-callback"],f=r.config["forbidden-chars-text"],r.throwError(u,f,s[a]);for(t in r.keys.add)if(i===r.keys.add[t]&&!r.config["no-"+t])return e.preventDefault(),r.add()}else for(t in o)if(i===o[t]){if(r.keys.add[t])return e.preventDefault(),!0;if(r.keys.remove[t]&&!r.config["no-"+t])return e.preventDefault(),r.remove()}return!0}),r.config["tag-on-blur"]&&r.$type_zone.focusout(function(){return a=r.valInput(),a&&a.length?r.add():!1}),r.$elem.on("click",function(){r.focusInput()}),r.refresh(t),r},refresh:function(t){var n,r;return n=this,r=n.config["pre-tags-separator"],t=t||n.getTags().join(r),n.reset(),e.each(t.split(r),function(){n.add(this+"")}),!0},remove:function(t){var n,r,a;if(n=this,e.isArray(t))return e.each(t,function(){n.remove(this+"")});if("string"==typeof t&&(r=t,t=n.$elem.find("input[value="+r+"]").parent(),!t.length))return"Error -> Tag not found";if(t)for(a=n.tags.length;a--;)n.tags[a][0].innerHTML===t[0].innerHTML&&n.tags.splice(a,1);else t=n.tags.pop();return r=r||t.pure_text,t.remove(),n.config["edit-on-delete"]&&(n.emptyInput(),n.valInput(t.pure_text)),t},removeAll:function(){return this.reset()},removeSpecialKeys:function(t){var n,a,i,o,s;if(n=this,s=t[0],o=t[1],i={},e.isArray(o))return e.each(o,function(){n.removeSpecialKeys([s,this])});for(a in n.keys[s])n.keys[s].hasOwnProperty(a)&&n.keys[s][a]===o&&(n.keys[s][a]=r);return n.keys[s]},reset:function(){for(;this.tags.length;)this.remove(this.tags[this.tags.length]);return this.emptyInput(),this.tags},throwError:function(e,t,n){return e([t+" '"+n+"'."])},valInput:function(e){return null==e?this.$type_zone.val():this.$type_zone.val(e)}},e.fn.tagging=function(t,n){var r=[];return this.each(function(){var i,o,s;i=e(this),o=i.data("tag-box"),o?(s=o[t](n),s&&r.push(s)):(o=new a(this,t),i.data("tag-box",o),o.init(),r.push(o.$elem))}),"string"==typeof t?r.length>1?r:r[0]:r}}(window.jQuery,window,document);function inforeplace(t,i){for(var e=t.length,n=i;n>1;n--){var o=t.charAt(n);if(" "==o)return t.splice(n,e,"...")}}function setoption(t){var i=t.attr("href").match(/\d/),e=t.text(),n='<a data="'+i+'" onclick="setforum.call(this)" title="'+e+'" href="javascript:;">'+e+"</a>",o='<span class="option">'+n+"</span>",s='<li onclick="setprefix.call(this)" class="row-prefix">'+e+"</li>";$(".catalogue-list .wbb-list").append(o),$(".prefix-list").append(s)}function setprefix(){var t=$(this).text();$showprefix=!0,$(".prefix-input").val(t),$(".prefix-list").hide()}function copy_link(){var t=$(this).attr("src");$(".description-input input").val(t),$(".list-img").removeClass("show").addClass("hide")}function setforum(){var t=$(window).scrollTop(),i=$(this).attr("data"),e=$(this).text();if($forum.length>1&&$forum!=e){var n=$('#tagBox input[value="'+$forum.toLowerCase()+'"]').closest(".tag");n.find(".tag-i").trigger("click"),n.remove(),$(".type-zone").val("")}($forum!=e||$tag_box.tagging("getTags").toString().toUpperCase().indexOf($forum.toUpperCase())<0)&&($forum=e,$tag_box.tagging("add",$forum)),$('.submit-editor input[name="f"]').attr("value",i),$(this).closest(".wbb-list").find(".selected").removeClass("selected"),$(this).parent().addClass("selected"),$(".catalogue-list .wbb-select .val").text(e),$(".catalogue-list .wbb-list").hide(),$(window).scrollTop(t)}function uploadimg(){if(0==$("#body-upload").length){$(".wysibb-body").after('<div id="body-upload" style="display:block"><div class="dropzone" style="display:block"></div></div>').hide();var t=function(t){if(t.success===!0){$("#body-upload").hide();var i='<img src="'+t.data.link+'" /><br>';$(".wysibb-body").append(i),$(".wysibb-body").show();var e=$('img[src="'+t.data.link+'"]:last').offset().top;e>600&&$("html, body").animate({scrollTop:e},500)}};new Imgur({clientid:"	cc121d51c7632a1",callback:t})}else{var i=$("#body-upload").attr("style");i.indexOf("none")>-1?($("#body-upload").show(),$(".wysibb-body").hide()):($("#body-upload").hide(),$(".wysibb-body").show())}}function settag(t){var i;return $.each(t,function(e){var n=t[e].replace(/\s/gi,"-"),o="#"+n+",";i+=o}),i.replace(/[ ]/g,"").split(",").removeDuplicate().join(", ").replace(/undefined|\,$/g,"")}!function(t){t.GoogleURLShortener=function(i){var e=t.extend({key:null,mode:"auto",url:null,success:function(t,i){},error:function(t,i){}},i),n=function(t){e.error(t,{error:{code:400,message:t,data:[{domain:"global",reason:"Invalid",message:t}]}})},o=e.url;""!==o&&/\b((?:https?:\/\/|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))/.test(o)&&!/^http:\/\/goo\.gl\/?$/.test(o)?(window.gapi_onload=function(t){var i=gapi.client;i.setApiKey(e.key),i.load("urlshortener","v1",function(t){if("object"==typeof t)e.error(t.error.message,t);else{t=e.mode;var s,a;switch("auto"==t&&(t=/http:\/\/goo\.gl\/.+/.test(o)?"short":"long"),t){case"long":s=i.urlshortener.url.insert({resource:{longUrl:o}}),a="id";break;case"short":s=i.urlshortener.url.get({shortUrl:o}),a="longUrl"}s?s.execute(function(t){t.error?e.error(t.error.message,t):null!==t[a]?e.success(t[a],t):e.error(t.error.message,t)}):n("Invalid Setting")}})},t.getScript("https://apis.google.com/js/client.js")):n("Invalid Value")}}(jQuery),String.prototype.splice=function(t,i,e){return this.substr(0,t)+e+this.substr(i,this.length)};var npost=location.hash.match(/\d+/),$forum="";if(null!=npost)var edit=!0;else var edit=!1;$(function(){$("#editor").wysibb(),$(".catalogue-list .wbb-select").toggle(function(){$(".catalogue-list .wbb-list").show()},function(){$(".catalogue-list .wbb-list").hide()});var t=$("#tagBox").tagging();$tag_box=t[0],1!=edit?($tag_box.tagging("add","news"),$listforum=sessionStorage.getItem("listforum"),null!=$listforum?$(".list-cate-top .title-link").each(function(){setoption($(this))}):$.get("/").done(function(t){$(t).find(".link-column .title-link").each(function(){setoption($(this))})})):($(".catalogue-list").remove(),$("#loading,#load-content").fadeIn(500),$.get("/post?p="+npost+"&mode=editpost").done(function(t){if($(t).find("#text_editor_textarea").length>0){var i=$(t).find("#text_editor_textarea").text(),e=i.match(/\[sub\]\[hr\](.+)\[\/sub\]/);if(null!=e){var i=i.replace(/\[sub\]\[hr\](.+)\[\/sub\]/,""),n=e[1].replace(/#/g,""),n=n.split(",");$.each(n,function(t){n[t].length>3&&$tag_box.tagging("add",n[t])})}var o=$(t).find('input[name="subject"]').val(),s=o.split("||"),o=s[1],a=$(t).find('input[name="description"]').val();$(".prefix-input").val(s[0]),$(".subject-input").val(o),$(".description-input input").val(a);var r=$(t).find('.submit-buttons input[type="hidden"]');$(".wysibb-body").html(i),$(".modesw").trigger("click"),$(".modesw").trigger("click"),$('.submit-editor input[type="hidden"]').remove(),$(".submit-editor").append(r),$("#loading,#load-content").fadeOut(500)}else alert("Bạn không có quyền sửa bài"),location.href="/"})),$(".btt-submit").click(function(t){var i=!0,e=$(".subject-input").val(),n=$(".description-input input").val(),o=$(".wysibb-body"),s=$tag_box.tagging("getTags"),a=$('.submit-editor input[name="f"]').val(),r=$("#editor").bbcode(),l=(e.match(/^(\[.+\])(?=\s)|^(?=\s)(\[.+\])(?=\s)|^(\[.+\])(?=\w)/),o.find('a[href*="youtube"]').attr("href")),u=o.find("img:first").attr("src"),d=$(".prefix-input").val();if(0==d.length)return note("Bạn chưa đặt tiền tố cho bài viết.","Lỗi Tiền Tố"),!1;if(e.length<15)return note("Tiêu đề bài viết quá ngắn.","Lỗi Tiêu Đề"),!1;if(e.length>255)return note("Tiêu đề bài viết quá dài.","Lỗi Tiêu Đề"),!1;if(0==n.length||0==/\.jpg|\.gif|\.png|\.jpeg/.test(n))if(void 0!=u)$(".description-input input").val(u);else if(void 0==l)return note("Bạn phải điền ảnh giới thiệu vào bài viết. Và định dạng ảnh phải là png,jpg hoặc gif mới được.","Lỗi link ảnh giới thiệu"),!1;if(0==edit&&0==a.length)return note("Xin vui lòng chọn chuyên mục để gửi bài.","Chưa chọn chuyên mục"),!1;if(0==r.length)return note("Xin vui lòng nhập nội dung bài viết.","Nội dung bài viết"),!1;if(r.length<300&&void 0==l&&void 0!=l)return note("Nội dung bài viết của bạn quá ngắn.","Nội dung bài viết"),!1;if(r.length>9e3)return note("Nội dung bài viết của bạn quá dài","Nội dung bài viết"),!1;if($(this).attr("disabled","disabled"),loading(!0),void 0!=l){var c=l.match(/^http[s]*:\/\/www\.youtube\.com\/(?:watch|embed)(?:\?.*?v=|\/)([a-z0-9_-]+)/i);if(null!=c){var u="http://img.youtube.com/vi/"+c[1]+"/sddefault.jpg";$(".description-input input").val(u)}}if(void 0==u&&void 0!=n)var u=n;console.log(u),void 0!=u&&(i=!1,$.GoogleURLShortener({key:"AIzaSyA3M834Rk4jS0L3GkVa8vj9x7FusIH57hs",mode:"auto",url:u,success:function(t,i){var n=d+"||"+e+"||"+t,a=n.length;if(!(255>a))return note("Tiêu đề bài viết quá dài","Tiêu đề quá dài"),!1;var l=o.text(),u=250-a,l=l.slice(0,u),l=inforeplace(l,l.length);if(n+="||"+l,$(".subject-input").val(n).addClass("active"),0==edit){var c=r.match(/([A-Z]\w+\s[A-Z]\w+(?=\s|\.|\,|\!|\?))/g);if(null!=c)var c=settag(c);else c="";var g=settag(s);if(c+=g,null!=p){var p=p[0].replace(/\[|\]/g,"");if(p!=$(".catalogue-list .option.selected").text()){var p="#"+p.replace(/\s/g,"-");c+=p}}}else s.length>0&&(c=settag(s));o.append('<div class="tag-list">[sub][hr]'+c+"[/sub]</div>"),$("#editor").sync(),setTimeout(function(){$('.submit-editor input[type="submit"]').trigger("click")},1e3)}}))}),$(".album-img").click(function(){var t=$(".list-img"),i=t.attr("class");if(0==t.find(".out-img img").length){var e=$(".wysibb-body img");if(e.length>0){t.find(".no-img").hide();var n="";e.each(function(){n+='<img src="'+this.src+'" onclick="copy_link.call(this)">'}),t.find(".out-img").html(n)}else t.find(".no-img").show()}i.indexOf("show")>-1?(t.removeClass("show").addClass("hide"),t.find(".out-img").html("")):t.removeClass("hide").addClass("show")}),$(".prefix-input").blur(function(){setTimeout(function(){$(".prefix-list").hide()},1e3)}),$(".prefix-input").focus(function(){$(".prefix-list").show()})}),Array.prototype.removeDuplicate=function(){for(var t=[],i=0;i<this.length;i++)-1==t.indexOf(this[i])&&t.push(this[i]);return t},window.addEventListener("scroll",function(t){var i=$(window).scrollTop(),e=$(".wysibb-text").offset().top;i>e?$(".wysibb-toolbar").addClass("fixed"):$(".wysibb-toolbar").removeClass("fixed"),i>$(document).height()-1e3?$(".btt-submit").removeClass("fixed"):$(".btt-submit").addClass("fixed")},!1);