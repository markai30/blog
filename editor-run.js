function inforeplace(t,e){for(var i=t.length,n=e;n>1;n--){var a=t.charAt(n);if(" "==a)return t.splice(n,i,"...")}}function setprefix(){var t=$(this).text(),e=$(this).attr("class");1==/prefix/.test(e)?($(".prefix-input").val(t),$(".prefix-list").hide()):$(this).addClass("select");var e=new RegExp(t,"i");0==e.test($tag_box.tagging("getTags").toString())&&$tag_box.tagging("add",t)}function $changeforum(){var t=$(this).attr("dataid"),e=$(this).text();$this=$(this).closest(".wysibb-toolbar-btn"),$this.find(".val").text(e),$('.submit-editor input[name="f"]').val(t),$this.find(".select").removeClass(".select"),$(this).addClass(".select")}function $post(t,e,i,n,a){var s=t+" • "+e+" • "+i,o=s.length;if(!(255>o))return note("Tiêu đề bài viết quá dài","Tiêu đề quá dài"),!1;var r=$("<div>"+n.html().replace(/\<br\>|\<\/br\>/g,"¶")+"</div>").text(),l=250-o;if(r.length>=l)var r=r.slice(0,l),r=inforeplace(r,r.length);s+=" • "+r,$(".subject-input").val(s).addClass("active"),0==$('.tag[data^="news"]').length&&$tag_box.tagging("add","news");var c=new RegExp(t,"i");if(0==c.test($tag_box.tagging("getTags").toString())&&$tag_box.tagging("add",t),0==edit)var d=settag(a,!0);else if(a.length>0)var d=settag(a,!0);var u=n.find('a[href$="#framepost"]').attr("href");0==/vcplayer/.test(u)&&void 0!=u&&$('input[name="f"]').val("1"),n.append('<div class="tag-list">[sub][hr]'+d.replace(/\,\s/g,"|").replace(/\s/g,"-").replace(/\|/g,", ")+"[/sub]</div>"),$("#editor").sync(),setTimeout(function(){$('.submit-editor input[type="submit"]').trigger("click")},1e3)}function copy_link(){var t=$(this).attr("src");$(".description-input input").val(t),$(".list-img").removeClass("show").addClass("hide")}function uploadimg(){if($(".wysibb-toolbar-btn").toggleClass("dis"),$(this).parent().removeClass("dis"),0==$("#body-upload").length){$(".wysibb-body").after('<div id="body-upload" style="display:block"><div class="dropzone" style="display:block"></div></div>').hide();var t=function(t){if(t.success===!0){$("#body-upload").hide();var e='<img src="'+t.data.link+'" /><br>';$(".wysibb-body").append(e),$(".wysibb-body").show();var i=$('img[src="'+t.data.link+'"]:last').offset().top;i>600&&$("html, body").animate({scrollTop:i},500)}};new Imgur({clientid:$idimgur,callback:t})}else{var e=$("#body-upload").attr("style");e.indexOf("none")>-1?($("#body-upload").show(),$(".wysibb-body").hide()):($("#body-upload").hide(),$(".wysibb-body").show())}}function settag(t,e){for(var i="",n=0;n<t.length;n++){var a=t[n].replace(/(\s|\.|\,|\!|\?|\"|\')$/g,""),s=new RegExp(a,"i");0==s.test(i)&&(i+=1==e?"#"+a+", ":a+"|")}return i}!function(t,e){"use strict";"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?module.exports=e():t.Imgur=e()}(this,function(){"use strict";var t=function(e){if(!(this&&this instanceof t))return new t(e);if(e||(e={}),!e.clientid)throw"Provide a valid Client Id here: http://api.imgur.com/";this.clientid=e.clientid,this.endpoint="https://api.imgur.com/3/image",this.callback=e.callback||void 0,this.dropzone=document.querySelectorAll(".dropzone"),this.run()};return t.prototype={createEls:function(t,e,i){var n,a=document.createElement(t);for(n in e)e.hasOwnProperty(n)&&(a[n]=e[n]);return i&&a.appendChild(document.createTextNode(i)),a},insertAfter:function(t,e){t.parentNode.insertBefore(e,t.nextSibling)},post:function(t,e,i){var n=new XMLHttpRequest;n.open("POST",t,!0),n.setRequestHeader("Authorization","Client-ID "+this.clientid),n.onreadystatechange=function(){if(4===this.readyState){if(!(this.status>=200&&this.status<300))throw new Error(this.status+" - "+this.statusText);var t="";try{t=JSON.parse(this.responseText)}catch(e){t=this.responseText}i.call(window,t)}},n.send(e),n=null},createDragZone:function(){var t,e;t=this.createEls("p",{},""),e=this.createEls("input",{type:"file",accept:"image/*",onchange:"document.getElementById('img-preview').src = window.URL.createObjectURL(this.files[0])"}),Array.prototype.forEach.call(this.dropzone,function(e){e.appendChild(t),$(".dropzone p").html('<span class="load-img-up"><img id="img-preview" src=""></span><span style="margin-left:20px"><i class="fa fa-file-image-o" aria-hidden="true" style="font-size: 40px;margin-right: 10px;"></i><i>Thả file hoặc click vào đây để upload ảnh.</i></span>'),$(".dropzone").append('<input onchange="document.getElementById(\'img-preview\').src = window.URL.createObjectURL(this.files[0])" type="file" accept="image/*">'),this.status(e),this.upload(e)}.bind(this))},loading:function(){},status:function(t){var e=this.createEls("div",{className:"status"});this.insertAfter(t,e)},matchFiles:function(t,e){var i=e.nextSibling;if(t.type.match(/image/)&&"image/svg+xml"!==t.type){$(".load-img-up").addClass("load"),$(".dropzone input").attr("disabled","disabled"),i.classList.remove("bg-success","bg-danger"),i.innerHTML="";var n=new FormData;n.append("image",t),this.post(this.endpoint,n,function(t){$(".load-img-up").removeClass("load"),$(".dropzone input").removeAttr("disabled"),"function"==typeof this.callback&&this.callback.call(this,t)}.bind(this))}else i.classList.remove("bg-success"),i.classList.add("bg-danger"),i.innerHTML="Invalid archive"},upload:function(t){var e,i,n,a,s=["dragenter","dragleave","dragover","drop"];t.addEventListener("change",function(s){if(s.target&&"INPUT"===s.target.nodeName&&"file"===s.target.type)for(i=s.target.files,n=0,a=i.length;a>n;n+=1)e=i[n],this.matchFiles(e,t)}.bind(this),!1),s.map(function(e){t.addEventListener(e,function(t){t.target&&"INPUT"===t.target.nodeName&&"file"===t.target.type&&("dragleave"===e||"drop"===e?t.target.parentNode.classList.remove("dropzone-dragging"):t.target.parentNode.classList.add("dropzone-dragging"))},!1)})},run:function(){var t=document.querySelector(".loading-modal");t||this.loading(),this.createDragZone()}},t}),function(t,e,i,n){var a=function(e,i){this.elem=e,this.$elem=t(e),this.options=i,this.tags=[]};a.prototype={keys:{add:{comma:188,enter:13,spacebar:32},remove:{del:46,backspace:8}},defaults:{"case-sensitive":!1,"close-char":"&times;","close-class":"tag-i","edit-on-delete":!0,"forbidden-chars":[".","_","?"],"forbidden-chars-callback":e.alert,"forbidden-chars-text":"Từ này bị cấm:","forbidden-words":[],"forbidden-words-callback":e.alert,"forbidden-words-text":"Forbidden word:","no-backspace":!1,"no-comma":!1,"no-del":!1,"no-duplicate":!0,"no-duplicate-callback":e.alert,"no-duplicate-text":"Nhãn này bị trùng:","no-enter":!1,"no-spacebar":!0,"pre-tags-separator":", ","tag-box-class":"tagging","tag-char":"#","tag-class":"tag","tags-input-name":"tag","tag-on-blur":!0,"type-zone-class":"type-zone"},add:function(e){var n,a,s,o,r,l,c;if(s=this,t.isArray(e))return t.each(e,function(){s.add(this+"")});if(r=s.config["forbidden-words"],e||(e=s.valInput(),s.emptyInput()),!e||!e.length)return!1;for(s.config["case-sensitive"]||(e=e.toLowerCase()),a=r.length;a--;)if(o=e.indexOf(r[a]),o>=0)return s.emptyInput(),l=s.config["forbidden-words-callback"],c=s.config["forbidden-words-text"],s.throwError(l,c,e);if(s.config["no-duplicate"])for(a=s.tags.length;a--;)if(s.tags[a].pure_text===e)return s.emptyInput(),l=s.config["no-duplicate-callback"],s.throwError(l,c,e);return n=t(i.createElement("div")).addClass(s.config["tag-class"]).attr("data",e).html("<span>"+s.config["tag-char"]+"</span> "+e),t(i.createElement("input")).attr("type","hidden").attr("name",s.config["tags-input-name"]+"[]").val(e).appendTo(n),t(i.createElement("a")).attr("role","button").addClass(s.config["close-class"]).html(s.config["close-char"]).click(function(){s.remove(n)}).appendTo(n),n.pure_text=e,s.tags.push(n),s.$type_zone.before(n),!0},addSpecialKeys:function(e){var i,n,a,s,o;if(i=this,o=e[0],s=e[1],a={},t.isArray(s))return t.each(s,function(){i.addSpecialKeys([o,this])});if(!s&&s.constructor!==Object)return"Error -> The second argument is not an Object!";for(n in s)s.hasOwnProperty(n)&&s[n]===+s[n]&&s[n]===(0|s[n])&&t.extend(a,s);return i.keys[o]=t.extend({},a,i.keys[o]),i.keys[o]},destroy:function(){return this.$elem.find("."+this.config["type-zone-class"]).remove(),this.$elem.find("."+this.config["tag-class"]).remove(),this.$elem.data("tag-box",null),!0},emptyInput:function(){return this.focusInput(),this.valInput("")},focusInput:function(){return this.$type_zone.focus()},getDataOptions:function(){var t,e,i;i={};for(t in this.defaults)e=this.$elem.data(t),e&&(i[t]=e);return i},getSpecialKeys:function(){return t.extend({},this.keys.add,this.keys.remove)},getSpecialKeysD:function(){return this.keys},getTags:function(){var t,e,i;for(i=this.tags.length,t=[],e=0;i>e;e+=1)t.push(this.tags[e].pure_text);return t},getTagsObj:function(){return this.tags},init:function(){var e,n,a;return n=this,n.config=t.extend({},n.defaults,n.options,n.getDataOptions()),e=n.$elem.text(),n.$elem.empty(),n.$type_zone=t(i.createElement("input")).addClass(n.config["type-zone-class"]).attr("contenteditable",!0),n.$elem.addClass(n.config["tag-box-class"]).append(n.$type_zone),n.$type_zone.keydown(function(t){var e,i,a,s,o,r,l,c,d;if(o=n.getSpecialKeys(),r=n.config["forbidden-chars"],l=n.valInput(),s=t.which,l){for(a=r.length;a--;)if(i=l.indexOf(r[a]),i>=0)return t.preventDefault(),l=l.replace(r[a],""),n.focusInput(),n.valInput(l),c=n.config["forbidden-chars-callback"],d=n.config["forbidden-chars-text"],n.throwError(c,d,r[a]);for(e in n.keys.add)if(s===n.keys.add[e]&&!n.config["no-"+e])return t.preventDefault(),n.add()}else for(e in o)if(s===o[e]){if(n.keys.add[e])return t.preventDefault(),!0;if(n.keys.remove[e]&&!n.config["no-"+e])return t.preventDefault(),n.remove()}return!0}),n.config["tag-on-blur"]&&n.$type_zone.focusout(function(){return a=n.valInput(),a&&a.length?n.add():!1}),n.$elem.on("click",function(){n.focusInput()}),n.refresh(e),n},refresh:function(e){var i,n;return i=this,n=i.config["pre-tags-separator"],e=e||i.getTags().join(n),i.reset(),t.each(e.split(n),function(){i.add(this+"")}),!0},remove:function(e){var i,n,a;if(i=this,t.isArray(e))return t.each(e,function(){i.remove(this+"")});if("string"==typeof e&&(n=e,e=i.$elem.find("input[value="+n+"]").parent(),!e.length))return"Error -> Tag not found";if(e)for(a=i.tags.length;a--;)i.tags[a][0].innerHTML===e[0].innerHTML&&i.tags.splice(a,1);else e=i.tags.pop();return n=n||e.pure_text,e.remove(),i.config["edit-on-delete"]&&(i.emptyInput(),i.valInput(e.pure_text)),e},removeAll:function(){return this.reset()},removeSpecialKeys:function(e){var i,a,s,o,r;if(i=this,r=e[0],o=e[1],s={},t.isArray(o))return t.each(o,function(){i.removeSpecialKeys([r,this])});for(a in i.keys[r])i.keys[r].hasOwnProperty(a)&&i.keys[r][a]===o&&(i.keys[r][a]=n);return i.keys[r]},reset:function(){for(;this.tags.length;)this.remove(this.tags[this.tags.length]);return this.emptyInput(),this.tags},throwError:function(t,e,i){return t([e+" '"+i+"'."])},valInput:function(t){return null==t?this.$type_zone.val():this.$type_zone.val(t)}},t.fn.tagging=function(e,i){var n=[];return this.each(function(){var s,o,r;s=t(this),o=s.data("tag-box"),o?(r=o[e](i),r&&n.push(r)):(o=new a(this,e),s.data("tag-box",o),o.init(),n.push(o.$elem))}),"string"==typeof e?n.length>1?n:n[0]:n}}(window.jQuery,window,document),String.prototype.splice=function(t,e,i){return this.substr(0,t)+i+this.substr(e,this.length)};var npost=location.search,$forum="";if(npost.indexOf("editpost")>-1)var edit=!0;else var edit=!1;$(function(){$("#editor").wysibb(),$(".catalogue-list .wbb-select").toggle(function(){$(".catalogue-list .wbb-list").show()},function(){$(".catalogue-list .wbb-list").hide()});var t=$("#tagBox").tagging();if($tag_box=t[0],1!=edit)$tag_box.tagging("add","news"),$(".subject-input").removeClass("active");else{var e=$(".subject-input").val(),i=e.split(" • "),e=i[1],n=$(".description-input input").val();$(".prefix-input").val(i[0]),$(".subject-input").val(e).removeClass("active"),$(".description-input input").val(n);var a=$("#editor").text();if($list=a.split(/\[sub\]\[hr\](\#.+)\[\/sub\]/),$(".modesw").trigger("click"),$("#editor").bbcode($list[0]),$(".modesw").trigger("click"),null!=$list[1]){var s=$list[1].replace(/\#|\s/g,"").replace(/\-/g," ").split(","),s=settag(s,!1),s=s.split("|");$.each(s,function(t,e){e.length>0&&$tag_box.tagging("add",e)})}}$(".btt-submit").click(function(t){var e=$(".subject-input").val(),i=$(".description-input input").val(),n=$(".wysibb-body"),a=$tag_box.tagging("getTags"),s=($('.submit-editor input[name="f"]').val(),$("#editor").bbcode()),o=(e.match(/^(\[.+\])(?=\s)|^(?=\s)(\[.+\])(?=\s)|^(\[.+\])(?=\w)/),n.find('a[href*="youtube"]').attr("href")),r=n.find("img:first").attr("src"),l=$(".prefix-input").val();if(0==l.length)return note("Bạn chưa đặt tiền tố cho bài viết.","Lỗi Tiền Tố"),!1;if(e.length<15)return note("Tiêu đề bài viết quá ngắn.","Lỗi Tiêu Đề"),!1;if(e.length>255)return note("Tiêu đề bài viết quá dài.","Lỗi Tiêu Đề"),!1;if(1==/http|¶|•/g.test(e))return note("Xin đừng chèn ký tự lạ hoặc link vào tiêu đề bài viết.","Lỗi Tiêu Đề"),!1;if(0==i.length||0==/\.jpg|\.gif|\.png|\.jpeg/.test(i))if(void 0!=r)$(".description-input input").val(r);else if(void 0==o)return note("Bạn phải điền ảnh giới thiệu vào bài viết. Và định dạng ảnh phải là png,jpg hoặc gif mới được.","Lỗi link ảnh giới thiệu"),!1;if(0==s.length)return note("Xin vui lòng nhập nội dung bài viết.","Nội dung bài viết"),!1;if(s.length<300&&void 0==o&&void 0!=o)return note("Nội dung bài viết của bạn quá ngắn.","Nội dung bài viết"),!1;if(s.length>9e3)return note("Nội dung bài viết của bạn quá dài","Nội dung bài viết"),!1;if($(this).attr("disabled","disabled"),loading(!0),void 0!=o){var c=o.match(/^http[s]*:\/\/www\.youtube\.com\/(?:watch|embed)(?:\?.*?v=|\/)([a-z0-9_-]+)/i);if(null!=c){var r="http://i1.ytimg.com/vi/"+c[1]+"/0.jpg";$(".description-input input").val(r)}}if(void 0==r&&void 0!=i)var r=i;void 0!=r&&$.ajax({url:"https://api.imgur.com/3/upload",method:"POST",headers:{Authorization:"Client-ID "+$idimgur,Accept:"application/json"},data:{image:r,type:"URL"},success:function(t){if(1==t.success)var i=t.data.link;$post(l,e,i,n,a)},error:function(t,i,s){$.get($imgsafe+"?url="+r).done(function(t){if(1==t.OK)var i=t.url;$post(l,e,i,n,a)}).fail(function(){note("Đã xảy ra lỗi khi post bài. Xin vui lòng thử lại","Lỗi rồi"),setTimeout(function(){location.reload()},5e3)})}})}),$(".album-img").click(function(){var t=$(".list-img"),e=t.attr("class");if(0==t.find(".out-img img").length){var i=$(".wysibb-body img");if(i.length>0){t.find(".no-img").hide();var n="";i.each(function(){n+='<img src="'+this.src+'" onclick="copy_link.call(this)">'}),t.find(".out-img").html(n)}else t.find(".no-img").show()}e.indexOf("show")>-1?(t.removeClass("show").addClass("hide"),t.find(".out-img").html("")):t.removeClass("hide").addClass("show")}),$(".prefix-input").blur(function(){setTimeout(function(){$(".prefix-list").hide()},500)}),$(".prefix-input").focus(function(){$(".prefix-list").show()}),$("#tagBox .type-zone").blur(function(){setTimeout(function(){$("#tags-list-select").hide()},500)}),$("#tagBox .type-zone").on("input",function(){var t=$(this).offset().left,e=$("#tagBox").offset().left,i=t-e+15+"px";$("#tags-list-select").show().css("left",i)}),$("#tagBox .type-zone").focus(function(){var t=$(this).offset().left,e=$("#tagBox").offset().left,i=t-e+15+"px",n=$("#editor").bbcode().match(/(((([A-Z]|Đ|Ý|Á|Â|Ẩ|Ô|Ó|Ố)(à|á|ạ|ả|ã|â|ầ|ấ|ậ|ẩ|ẫ|ă|ằ|ắ|ặ|ẳ|ẵ|è|é|ẹ|ẻ|ẽ|ê|ề|ế|ệ|ể|ễ|ì|í|ị|ỉ|ĩ|ò|ó|ọ|ỏ|õ|ô|ồ|ố|ộ|ổ|ỗ|ơ|ờ|ớ|ợ|ở|ỡ|ù|ú|ụ|ủ|ũ|ư|ừ|ứ|ự|ử|ữ|ỳ|ý|ỵ|ỷ|ỹ|đ|\w){1,15})(\s|(?=|\,|\.|\]|\[|\'|\"|\;|\:|\n|\r|\t))){1,10})/g);if(null!=n){var a=settag(n,!1).split("|");if(a.length>2){var s="";$.each(a,function(t,e){if(e.length>2){var i='<li class="item-tags" onclick="setprefix.call(this)">'+e+"</li>";s+=i}}),$("#tags-list-select").html(s)}$("#tags-list-select").show().css("left",i)}}),$('.jumbox option[value^="f"]').each(function(){var t=$(this).attr("value").match(/\d+/),e=$(this).text().split("|--")[1],i='<div class="option" onclick="$changeforum.call(this)" dataid="'+t+'">'+e+"</div>";$(".catalogue-list .wbb-list").append(i)})}),Array.prototype.removeDuplicate=function(){for(var t=[],e=0;e<this.length;e++)-1==t.indexOf(this[e])&&t.push(this[e]);return t},window.addEventListener("scroll",function(t){var e=$(window).scrollTop(),i=$(".wysibb-text").offset().top;e>i?$(".wysibb-toolbar").addClass("fixed"):$(".wysibb-toolbar").removeClass("fixed"),e>$(document).height()-1e3?$(".btt-submit").removeClass("fixed"):$(".btt-submit").addClass("fixed")},!1);